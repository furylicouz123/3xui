# Docker Compose: Nginx + 3X-UI VPN Panel

## –û–ø–∏—Å–∞–Ω–∏–µ
–≠—Ç–æ—Ç Docker Compose —Ñ–∞–π–ª —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç:
- **Nginx** (–≤–µ—Ä—Å–∏—è 1.27-alpine) - –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –∏ –æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏
- **3X-UI** (–ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è) - –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VPN —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π VLESS, VMess, Trojan

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
vpn_server/
‚îú‚îÄ‚îÄ docker-compose.yml     # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker Compose
‚îú‚îÄ‚îÄ nginx.conf            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx
‚îú‚îÄ‚îÄ website/              # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –≤–µ–±-—Å–∞–π—Ç–∞ terminaus.ru
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îî‚îÄ‚îÄ assets/
‚îú‚îÄ‚îÄ ssl/                  # SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ cert.pem         # –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è 3X-UI –ø–∞–Ω–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ key.pem          # –ö–ª—é—á –¥–ª—è 3X-UI –ø–∞–Ω–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ terminaus.ru.crt # –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è terminaus.ru
‚îÇ   ‚îî‚îÄ‚îÄ terminaus.ru.key # –ö–ª—é—á –¥–ª—è terminaus.ru
‚îú‚îÄ‚îÄ logs/                 # –õ–æ–≥–∏
‚îÇ   ‚îî‚îÄ‚îÄ nginx/
‚îú‚îÄ‚îÄ data/                 # –î–∞–Ω–Ω—ã–µ 3X-UI
‚îÇ   ‚îî‚îÄ‚îÄ x-ui/
‚îú‚îÄ‚îÄ .env.example         # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ install.sh           # –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏
‚îú‚îÄ‚îÄ Makefile            # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–º
‚îî‚îÄ‚îÄ README-Docker.md    # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ –∏–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞
cd vpn_server

# –°–æ–∑–¥–∞–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
mkdir -p ssl logs/nginx data/x-ui website

# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞–ø–∫–∞ website —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–∞—à–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–∞–∫ –º–∏–Ω–∏–º—É–º index.html
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
```bash
# –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã)
# –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è 3X-UI –ø–∞–Ω–µ–ª–∏
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
    -keyout ssl/key.pem \
    -out ssl/cert.pem \
    -subj "/C=RU/ST=Moscow/L=Moscow/O=VPN-Server/CN=panel.your-domain.com"

# –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è terminaus.ru
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
    -keyout ssl/terminaus.ru.key \
    -out ssl/terminaus.ru.crt \
    -subj "/C=RU/ST=Moscow/L=Moscow/O=Terminaus/CN=terminaus.ru"

# –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Let's Encrypt
# certbot certonly --standalone -d panel.your-domain.com
# certbot certonly --standalone -d terminaus.ru
# cp /etc/letsencrypt/live/panel.your-domain.com/fullchain.pem ssl/cert.pem
# cp /etc/letsencrypt/live/panel.your-domain.com/privkey.pem ssl/key.pem
# cp /etc/letsencrypt/live/terminaus.ru/fullchain.pem ssl/terminaus.ru.crt
# cp /etc/letsencrypt/live/terminaus.ru/privkey.pem ssl/terminaus.ru.key
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `nginx.conf` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ `your-domain.com` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω.

### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
# –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

## üåê –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º

### –í–µ–±-—Å–∞–π—Ç terminaus.ru
- **URL**: `https://terminaus.ru`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–µ–±-—Å–∞–π—Ç
- **–§–∞–π–ª—ã**: `./website/`

### 3X-UI –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **URL**: `https://panel.your-domain.com` (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω)
- **–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø**: `http://your-server-ip:2053`
- **–õ–æ–≥–∏–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**: `admin`
- **–ü–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**: `admin`

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –°—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞ —Å–º–µ–Ω–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å!

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ 3X-UI

### –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
1. –í–æ–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2. –°–º–µ–Ω–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –≤ —Ä–∞–∑–¥–µ–ª–µ "Settings"
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "Panel Settings"
4. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ä–∞–∑–¥–µ–ª–µ "Inbounds"

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ò–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2053)
- –í–∫–ª—é—á–∏—Ç–µ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ IP
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –ø–∞—Ä–æ–ª–∏

## –ü–æ—Ä—Ç—ã
- **80** - HTTP (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS)
- **443** - HTTPS (Nginx + 3X-UI)
- **2053** - –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ 3X-UI –ø–∞–Ω–µ–ª–∏

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
# –õ–æ–≥–∏ Nginx
docker-compose logs nginx

# –õ–æ–≥–∏ 3X-UI
docker-compose logs xui

# –í—Å–µ –ª–æ–≥–∏
docker-compose logs
```

### –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats
```

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose down

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤
docker-compose pull

# –ó–∞–ø—É—Å–∫ —Å –Ω–æ–≤—ã–º–∏ –æ–±—Ä–∞–∑–∞–º–∏
docker-compose up -d
```

## –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
```bash
# –ë—ç–∫–∞–ø –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ 3X-UI
docker-compose exec xui tar -czf /tmp/xui-backup.tar.gz /etc/x-ui
docker cp $(docker-compose ps -q xui):/tmp/xui-backup.tar.gz ./xui-backup-$(date +%Y%m%d).tar.gz
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
docker cp ./xui-backup-YYYYMMDD.tar.gz $(docker-compose ps -q xui):/tmp/
docker-compose exec xui tar -xzf /tmp/xui-backup-YYYYMMDD.tar.gz -C /
docker-compose restart xui
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
docker-compose exec nginx ping xui

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
netstat -tlnp | grep -E ':(80|443|2053)'
```

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
1. **–û—à–∏–±–∫–∞ SSL**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç–∏ –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º –≤ nginx.conf
2. **–ù–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –ø–∞–Ω–µ–ª—å**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç 2053 –æ—Ç–∫—Ä—ã—Ç
3. **–ü—Ä–æ–±–ª–µ–º—ã —Å VPN**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ iptables –∏ forwarding

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –æ–±—Ä–∞–∑—ã Docker
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª (ufw/iptables)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (Let's Encrypt)
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ IP

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- [3X-UI GitHub](https://github.com/MHSanaei/3x-ui)
- [Nginx Documentation](https://nginx.org/en/docs/)
- [Docker Compose Documentation](https://docs.docker.com/compose/)